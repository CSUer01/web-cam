<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿œç¨‹ç›‘æ§æ§åˆ¶å°</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: #00ff00; font-family: 'Courier New', monospace; text-align: center; padding: 20px; }
        .monitor-box { width: 90%; max-width: 900px; margin: 20px auto; border: 2px solid #333; box-shadow: 0 0 20px rgba(0,255,0,0.4); position: relative; background: #111; }
        video { width: 100%; display: block; border-radius: 4px; }
        .controls { margin-top: 20px; background: #1a1a1a; padding: 25px; border-radius: 10px; border: 1px solid #333; }
        #status-bar { margin-bottom: 15px; font-size: 1.2rem; color: #ffcc00; text-shadow: 0 0 5px #ffcc00; }
        button { background: #00ff00; color: #000; border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border-radius: 5px; box-shadow: 0 0 10px #00ff00; transition: 0.2s; }
        button:active { transform: scale(0.95); box-shadow: 0 0 2px #00ff00; }
        .log { margin-top: 20px; font-size: 0.85rem; color: #888; text-align: left; max-width: 900px; margin: 20px auto; padding: 10px; background: #0a0a0a; border: 1px solid #222; overflow-y: auto; height: 100px; }
    </style>
</head>
<body>

    <h1 style="letter-spacing: 5px;">SYSTEM MONITORING v1.0</h1>
    
    <div id="status-bar">ç­‰å¾…ç³»ç»Ÿå¯åŠ¨...</div>

    <div class="monitor-box">
        <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <div class="controls">
        <p style="color: #888; margin-bottom: 10px;">ç¡®ä¿æ‰‹æœºç«¯ç½‘é¡µå·²å¼€å¯</p>
        <button onclick="connectToPhone()">ğŸ“¡ å‘èµ·è¿œç¨‹è¿æ¥</button>
    </div>

    <div class="log" id="logBox">ç»ˆç«¯æ—¥å¿—: [ç³»ç»Ÿå°±ç»ª]</div>

    <script>
        /*************************************************
         * é‡è¦é…ç½®ï¼šè¯·ç¡®ä¿è¿™é‡Œçš„ ID ä¸ä½ æ‰‹æœºç«¯ index.html é‡Œçš„å®Œå…¨ä¸€è‡´
         *************************************************/
        const targetPhoneId = 'my_secret_cam_9988'; 

        const logBox = document.getElementById('logBox');
        const statusBar = document.getElementById('status-bar');
        const remoteVideo = document.getElementById('remoteVideo');

        // 1. åˆå§‹åŒ– Peer å¯¹è±¡
        const peer = new Peer();

        peer.on('open', (id) => {
            statusBar.innerText = "ç³»ç»Ÿå°±ç»ª | æœ¬æœºID: " + id;
            addLog("[OK] æˆåŠŸè¿æ¥è‡³ Peer ä¿¡ä»¤æœåŠ¡å™¨");
        });

        // 2. è¿æ¥å‡½æ•°
        async function connectToPhone() {
            statusBar.innerText = "æ­£åœ¨å‘¼å«æ‰‹æœºç«¯...";
            addLog("[INFO] å°è¯•å¯»æ‰¾ç›®æ ‡ ID: " + targetPhoneId);

            try {
                // åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæµç”¨äºæ¡æ‰‹
                const canvas = document.createElement('canvas');
                canvas.width = canvas.height = 1;
                const stream = canvas.captureStream();

                // å‘èµ·å‘¼å«è¯·æ±‚
                const call = peer.call(targetPhoneId, stream);

                // ç›‘å¬å¯¹æ–¹å›ä¼ çš„è§†é¢‘æµ
                call.on('stream', (remoteStream) => {
                    statusBar.innerText = "ğŸŸ¢ å®æ—¶ç›‘æ§ä¸­";
                    statusBar.style.color = "#00ff00";
                    remoteVideo.srcObject = remoteStream;
                    addLog("[SUCCESS] æ¡æ‰‹æˆåŠŸï¼Œè§†é¢‘ä¼ è¾“ä¸­");
                });

            } catch (err) {
                statusBar.innerText = "ğŸ”´ å‘¼å«è¿‡ç¨‹å¼‚å¸¸";
                addLog("[ERROR] " + err.message);
            }
        }

        // è¾…åŠ©ï¼šæ—¥å¿—è®°å½•
        function addLog(msg) {
            const time = new Date().toLocaleTimeString();
            logBox.innerText += `\n[${time}] ${msg}`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // é”™è¯¯ç›‘æ§
        peer.on('error', (err) => {
            if(err.type === 'peer-unavailable') {
                statusBar.innerText = "ğŸ”´ æ— æ³•è¿æ¥ï¼šç›®æ ‡æ‰‹æœºä¸åœ¨çº¿";
                addLog("[ERR] æ‰¾ä¸åˆ° IDï¼Œè¯·æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ‰“å¼€äº†ç½‘é¡µ");
            } else {
                addLog("[ERR] ç±»å‹: " + err.type);
            }
        });
    </script>
</body>
</html>
