<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ§åˆ¶å° - éŸ³é¢‘ç›‘å¬</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: #00ff00; font-family: 'Courier New', monospace; text-align: center; padding: 40px; }
        .box { border: 1px solid #222; padding: 30px; background: #050505; max-width: 500px; margin: auto; }
        #v-meter { width: 100%; height: 10px; background: #111; margin: 20px 0; border-radius: 5px; overflow: hidden; }
        #v-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #004400, #00ff00); transition: width 0.1s; }
        button { background: #00ff00; color: #000; border: none; padding: 15px 40px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        #log { margin-top: 20px; font-size: 0.8rem; color: #444; }
    </style>
</head>
<body>
    <div class="box">
        <h3>AUDIO FEED</h3>
        <div id="status">ç­‰å¾…å‘¼å«...</div>
        
        <div id="v-meter"><div id="v-bar"></div></div>
        <p style="font-size: 0.7rem; color: #333;">éŸ³é¢‘æ³¢åŠ¨ç›‘æµ‹</p>

        <button onclick="listen()">ğŸ“¡ å¼€å¯è¿œç¨‹ç›‘å¬</button>
    </div>
    <div id="log">æ—¥å¿—ç­‰å¾…ä¸­...</div>

    <audio id="remoteAudio" autoplay></audio>

    <script>
        const targetID = 'my_secret_mic_8899';
        const peer = new Peer({
            config: { 'iceServers': [
                { urls: 'stun:stun.anyfirewall.com:3478' },
                { urls: 'stun:stun.stunprotocol.org:3478' }
            ]}
        });

        function listen() {
            document.getElementById('status').innerText = "å‘¼å«ä¸­...";
            // å‘èµ·è™šå‡æµä»¥è§¦å‘æ¡æ‰‹
            const call = peer.call(targetID, new AudioContext().createMediaStreamDestination().stream);

            call.on('stream', (remoteStream) => {
                document.getElementById('status').innerText = "ğŸŸ¢ ç›‘å¬æˆåŠŸ";
                const audio = document.getElementById('remoteAudio');
                audio.srcObject = remoteStream;
                audio.play();

                // éŸ³é‡è·³åŠ¨é€»è¾‘
                const ctx = new AudioContext();
                const src = ctx.createMediaStreamSource(remoteStream);
                const ana = ctx.createAnalyser();
                src.connect(ana);
                const data = new Uint8Array(ana.frequencyBinCount);
                
                function updateMeter() {
                    ana.getByteFrequencyData(data);
                    let val = data.reduce((a, b) => a + b, 0) / data.length;
                    document.getElementById('v-bar').style.width = Math.min(val * 3, 100) + "%";
                    requestAnimationFrame(updateMeter);
                }
                updateMeter();
                addLog("æˆåŠŸæ¥æ”¶éŸ³é¢‘æµ");
            });
        }

        function addLog(m) { document.getElementById('log').innerText = "[" + new Date().toLocaleTimeString() + "] " + m; }
    </script>
</body>
</html>
